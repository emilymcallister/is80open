<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Is I-80 Open?</title>
  <meta name="description" content="Quick at-a-glance status of Interstate 80 through the Sierra Nevada between Sacramento and Reno. Chain controls, closures, and restrictions.">
  <meta property="og:title" content="Is I-80 Open?">
  <meta property="og:description" content="Quick status check for I-80 through the Sierra Nevada.">
  <meta property="og:url" content="https://www.is80open.com">
  <meta property="og:type" content="website">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      overflow-x: hidden;
      position: relative;
      background-color: #374151;
      color: #e5e7eb;
    }

    body::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none;
      transition: background 1s ease;
    }

    body::after {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      opacity: 0.03;
      background-image: repeating-linear-gradient(0deg, transparent, transparent 80px, currentColor 80px, currentColor 81px);
      pointer-events: none;
    }

    /* STATUS THEMES ‚Äî background transitions smoothly */
    body.status-open {
      background-color: #2d5016;
      color: #d4e8c2;
    }
    body.status-open::before {
      background:
        radial-gradient(ellipse at 20% 50%, #3a6b1e44 0%, transparent 50%),
        radial-gradient(ellipse at 80% 20%, #3a6b1e33 0%, transparent 50%),
        radial-gradient(ellipse at 50% 80%, #3a6b1e22 0%, transparent 50%);
    }
    body.status-open .road-badge { border-color: #8fbc5a55; color: #8fbc5a; background: #3a6b1e33; }
    body.status-open .status-message a { color: #d4e8c2; }
    body.status-open .refresh-dot { background: #8fbc5a; }
    body.status-open .timestamp { color: #8fbc5a88; }

    body.status-restrictions {
      background-color: #7a6520;
      color: #fef3c7;
    }
    body.status-restrictions::before {
      background:
        radial-gradient(ellipse at 20% 50%, #967d2a44 0%, transparent 50%),
        radial-gradient(ellipse at 80% 20%, #967d2a33 0%, transparent 50%),
        radial-gradient(ellipse at 50% 80%, #967d2a22 0%, transparent 50%);
    }
    body.status-restrictions .road-badge { border-color: #d4a84355; color: #d4a843; background: #967d2a33; }
    body.status-restrictions .status-message a { color: #fef3c7; }
    body.status-restrictions .refresh-dot { background: #d4a843; }
    body.status-restrictions .timestamp { color: #d4a84388; }

    body.status-closed {
      background-color: #6b2039;
      color: #f5d0d8;
    }
    body.status-closed::before {
      background:
        radial-gradient(ellipse at 20% 50%, #86305044 0%, transparent 50%),
        radial-gradient(ellipse at 80% 20%, #86305033 0%, transparent 50%),
        radial-gradient(ellipse at 50% 80%, #86305022 0%, transparent 50%);
    }
    body.status-closed .road-badge { border-color: #d4637a55; color: #d4637a; background: #86305033; }
    body.status-closed .status-message a { color: #f5d0d8; }
    body.status-closed .refresh-dot { background: #d4637a; }
    body.status-closed .timestamp { color: #d4637a88; }

    body.status-unknown {
      background-color: #374151;
      color: #e5e7eb;
    }
    body.status-unknown::before {
      background:
        radial-gradient(ellipse at 20% 50%, #4b556344 0%, transparent 50%),
        radial-gradient(ellipse at 80% 20%, #4b556333 0%, transparent 50%);
    }
    body.status-unknown .road-badge { border-color: #9ca3af55; color: #9ca3af; background: #4b556333; }
    body.status-unknown .status-message a { color: #e5e7eb; }
    body.status-unknown .refresh-dot { background: #9ca3af; }
    body.status-unknown .timestamp { color: #9ca3af88; }

    /* LAYOUT */
    .container {
      position: relative;
      z-index: 1;
      text-align: center;
      padding: 2rem;
      max-width: 800px;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .road-badge {
      display: inline-block;
      margin-bottom: 1.5rem;
      padding: 0.4rem 1.2rem;
      border: 2px solid;
      border-radius: 999px;
      font-size: 0.85rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      /* Animation: starts hidden */
      opacity: 0;
      transform: translateY(-10px);
    }

    .status-heading {
      font-size: clamp(4rem, 15vw, 12rem);
      font-weight: 900;
      letter-spacing: -0.03em;
      line-height: 0.9;
      margin-bottom: 1.5rem;
      white-space: pre-line;
      text-align: center;
      width: 100%;
      /* Animation: starts hidden */
      opacity: 0;
      transform: scale(0.8);
    }

    .status-heading.long-text {
      font-size: clamp(2rem, 7vw, 6rem);
      line-height: 1.05;
    }

    .status-heading.medium-text {
      font-size: clamp(3rem, 10vw, 8rem);
      line-height: 1.0;
    }

    .status-message {
      font-size: clamp(1rem, 2.5vw, 1.5rem);
      font-weight: 400;
      line-height: 1.5;
      opacity: 0;
      max-width: 700px;
      margin: 0 auto;
      white-space: nowrap;
      text-align: center;
      /* Animation: starts hidden */
      transform: translateY(10px);
    }

    @media (max-width: 600px) {
      .status-message {
        white-space: normal;
        font-size: clamp(0.95rem, 4vw, 1.3rem);
      }
    }

    .status-message a {
      color: inherit;
      text-decoration: underline;
      text-underline-offset: 3px;
      text-decoration-thickness: 2px;
      font-weight: 600;
      transition: opacity 0.2s ease;
    }

    .status-message a:hover { opacity: 0.7; }

    .updated {
      margin-top: 2.5rem;
      font-size: 0.8rem;
      font-weight: 300;
      text-align: center;
      /* Animation: starts hidden */
      opacity: 0;
      transform: translateY(10px);
    }

    .timestamp {
      display: block;
      margin-top: 0.5rem;
      font-size: 0.95rem;
      font-weight: 500;
      font-variant-numeric: tabular-nums;
      letter-spacing: 0.02em;
    }

    .refresh-dot {
      display: inline-block;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      margin-left: 6px;
      animation: pulse 2s ease-in-out infinite;
      vertical-align: middle;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    /* ================================
       ANIMATION CLASSES
       Applied by JavaScript after data loads
       ================================ */

    .animate-in .road-badge {
      animation: fadeSlideDown 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards;
      animation-delay: 0.1s;
    }

    .animate-in .status-heading {
      animation: scaleIn 0.7s cubic-bezier(0.22, 1, 0.36, 1) forwards;
      animation-delay: 0.25s;
    }

    .animate-in .status-message {
      animation: fadeSlideUp 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards;
      animation-delay: 0.5s;
    }

    .animate-in .updated {
      animation: fadeSlideUp 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards;
      animation-delay: 0.7s;
    }

    @keyframes fadeSlideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes fadeSlideUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 0.9;
        transform: translateY(0);
      }
    }

    /* After animation completes, keep updated section subtle */
    .animate-in .updated {
      /* Final opacity handled by animation end state */
    }

    /* Loading state ‚Äî simple centered text */
    .loading-state .status-heading {
      font-size: clamp(1.5rem, 4vw, 2.5rem);
      opacity: 0.4;
      transform: scale(1);
      animation: loadingPulse 1.5s ease-in-out infinite;
      letter-spacing: 0.05em;
      font-weight: 400;
    }

    @keyframes loadingPulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.5; }
    }

    /* Re-check transition: subtle fade for updates after initial load */
    .recheck .road-badge,
    .recheck .status-heading,
    .recheck .status-message,
    .recheck .updated {
      animation: none;
      transition: opacity 0.4s ease, transform 0.4s ease;
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    .recheck .updated {
      opacity: 0.9;
    }

    /* Background color transition */
    body {
      transition: background-color 1s ease, color 1s ease;
    }

    /* Ad container */
    .ad-container {
      position: relative;
      z-index: 1;
      margin-top: 3rem;
      padding: 1rem;
      max-width: 728px;
      width: 100%;
      min-height: 0;
      text-align: center;
    }

    .ad-container.has-ad {
      min-height: 90px;
      background: rgba(0,0,0,0.1);
      border-radius: 8px;
    }

    .footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 1;
      text-align: center;
      padding: 1rem;
      font-size: 0.7rem;
      opacity: 0.3;
    }

    .footer a {
      color: inherit;
      text-decoration: none;
    }

    .footer a:hover {
      opacity: 0.8;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container loading-state" id="container">
    <div class="road-badge">I-80 In The Sierras</div>
    <h1 class="status-heading" id="heading">Checking conditions...</h1>
    <p class="status-message" id="message"></p>
    <div class="updated" id="updated-wrap">
      <span id="updated-source"></span>
      <span class="timestamp" id="live-clock"></span>
    </div>
  </div>

  <!-- Ad space -->
  <div class="ad-container" id="ad-container">
    <!-- ADSENSE CODE WILL GO HERE -->
  </div>

  <div class="footer">
    Data from <a href="https://roads.dot.ca.gov/" target="_blank" rel="noopener">Caltrans</a>.
    Not affiliated with Caltrans or any government agency.
    For official info, visit <a href="https://roads.dot.ca.gov/" target="_blank" rel="noopener">roads.dot.ca.gov</a>.
  </div>

  <script>
    var CALTRANS_URL = 'https://roads.dot.ca.gov/roadscell.php?roadnumber=80';
    var isFirstLoad = true;

    var RESTRICTION_HEADINGS = [
      'SORT OF.',
      "IT'S\nCOMPLICATED.",
      "IT'S MESSY\nOUT THERE.",
      'YIKES.',
      'GOOD LUCK\nJERRY.',
      'MAYBE\nRECONSIDER.',
      'BUCKLE UP\nBABY.',
      'A LITTLE YES\nA LITTLE NO.',
      'KIND OF.',
      'UH OH.',
      'LOOKS LIKE\nA BAD IDEA.',
      'MAYBE\nSTAY PUT.',
      'CAREFUL\nOUT THERE.'
    ];

    function getRandomRestrictionHeading() {
      var index = Math.floor(Math.random() * RESTRICTION_HEADINGS.length);
      return RESTRICTION_HEADINGS[index];
    }

    function getHeadingSizeClass(text) {
      var cleanText = text.replace(/\n/g, ' ');
      if (cleanText.length > 18) return 'long-text';
      if (cleanText.length > 10) return 'medium-text';
      return '';
    }

    var STATUS_CONFIG = {
      open: {
        heading: 'YES.',
        message: 'I-80 is open through the Sierras. More info <a href="URL" target="_blank" rel="noopener noreferrer">HERE</a>.',
        emoji: 'üü¢',
        titlePrefix: '‚úÖ YES'
      },
      restrictions: {
        heading: null,
        message: 'I-80 has some restrictions through the Sierras. More info <a href="URL" target="_blank" rel="noopener noreferrer">HERE</a>.',
        emoji: 'üü°',
        titlePrefix: '‚ö†Ô∏è RESTRICTIONS'
      },
      closed: {
        heading: 'NO.',
        message: 'I-80 is closed through the Sierras. More info <a href="URL" target="_blank" rel="noopener noreferrer">HERE</a>.',
        emoji: 'üî¥',
        titlePrefix: '‚ùå CLOSED'
      },
      unknown: {
        heading: 'UNKNOWN',
        message: 'Unable to determine I-80 status. Check <a href="URL" target="_blank" rel="noopener noreferrer">Caltrans</a> directly.',
        emoji: '‚ö™',
        titlePrefix: '‚ùì'
      }
    };

    var lastCheckedTime = null;

    function checkStatus() {
      fetch('/api/status')
        .then(function (response) { return response.json(); })
        .then(function (data) {
          lastCheckedTime = new Date();
          updatePage(data);
        })
        .catch(function (error) {
          console.error('Error checking status:', error);
          lastCheckedTime = new Date();
          updatePage({ status: 'unknown', checkedAt: 'Unable to check' });
        });
    }

    function updatePage(data) {
      var config = STATUS_CONFIG[data.status] || STATUS_CONFIG.unknown;
      var container = document.getElementById('container');

      // Get heading
      var heading;
      if (data.status === 'restrictions') {
        heading = getRandomRestrictionHeading();
      } else {
        heading = config.heading;
      }

      // Remove all status and animation classes from body
      document.body.classList.remove('status-open', 'status-restrictions', 'status-closed', 'status-unknown');

      // Remove old animation/loading classes from container
      container.classList.remove('loading-state', 'animate-in', 'recheck');

      // Set the content BEFORE animating
      var headingEl = document.getElementById('heading');
      headingEl.textContent = heading;
      headingEl.classList.remove('long-text', 'medium-text');
      var sizeClass = getHeadingSizeClass(heading);
      if (sizeClass) {
        headingEl.classList.add(sizeClass);
      }

      var messageHTML = config.message.replace(/URL/g, CALTRANS_URL);
      document.getElementById('message').innerHTML = messageHTML;

      document.getElementById('updated-source').innerHTML =
        'Data from Caltrans <span class="refresh-dot"></span>';

      document.title = 'Is I-80 Open? ' + config.titlePrefix;
      updateFavicon(config.emoji);

      // Apply status theme to body (triggers background color transition)
      document.body.classList.add('status-' + data.status);

      // Trigger animation
      // Use requestAnimationFrame to ensure DOM updates before animation starts
      requestAnimationFrame(function () {
        requestAnimationFrame(function () {
          if (isFirstLoad) {
            container.classList.add('animate-in');
            isFirstLoad = false;
          } else {
            container.classList.add('recheck');
          }
        });
      });
    }

    function updateFavicon(emoji) {
      var link = document.querySelector("link[rel*='icon']");
      if (!link) {
        link = document.createElement('link');
        link.rel = 'icon';
        document.head.appendChild(link);
      }
      link.href = "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>" + emoji + "</text></svg>";
    }

    function updateClock() {
      var now = new Date();
      var timeStr = now.toLocaleString('en-US', {
        timeZone: 'America/Los_Angeles',
        hour: 'numeric',
        minute: '2-digit',
        second: '2-digit',
        hour12: true,
      });

      var clockEl = document.getElementById('live-clock');
      if (clockEl) {
        if (lastCheckedTime) {
          var secondsAgo = Math.floor((now - lastCheckedTime) / 1000);
          var agoText;
          if (secondsAgo < 60) {
            agoText = 'just now';
          } else if (secondsAgo < 120) {
            agoText = '1 min ago';
          } else {
            agoText = Math.floor(secondsAgo / 60) + ' min ago';
          }
          clockEl.textContent = 'Last checked ' + agoText + '  ¬∑  ' + timeStr + ' PT';
        } else {
          clockEl.textContent = timeStr + ' PT';
        }
      }
    }

    // Start everything
    checkStatus();
    updateClock();

    // Update clock every second
    setInterval(updateClock, 1000);

    // Re-check road status every 2 minutes
    setInterval(checkStatus, 120000);
  </script>
</body>
</html>
